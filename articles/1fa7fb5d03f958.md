---
title: "Oracleã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­ã«ã§ãŸSysctlç³»ã‚¨ãƒ©ãƒ¼ã§ã‚ãŸã£ãŸkernel parameterã«ã¤ã„ã¦"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Oracle","Linux","Sysctl"]
published: true
---
# Oracleã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­ã«ã§ãŸSysctlç³»ã‚¨ãƒ©ãƒ¼ã§ã‚ãŸã£ãŸkernel parameterã«ã¤ã„ã¦
<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->
**Table of Contents**

- [Oracleã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­ã«ã§ãŸSysctlç³»ã‚¨ãƒ©ãƒ¼ã§ã‚ãŸã£ãŸkernel parameterã«ã¤ã„ã¦](#oracleã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­ã«ã§ãŸsysctlç³»ã‚¨ãƒ©ãƒ¼ã§ã‚ãŸã£ãŸkernel-parameterã«ã¤ã„ã¦)
    - [Motivation](#motivation)
    - [ãã‚‚ãã‚‚sysctlã¨ã¯ä½•ãªã®ã‹ï¼Ÿ](#ãã‚‚ãã‚‚sysctlã¨ã¯ä½•ãªã®ã‹)
    - [Oracleã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã«é­é‡ã—ãŸkernel parameters](#oracleã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã«é­é‡ã—ãŸkernel-parameters)
        - [semopm](#semopm)
            - [å¤‰æ›´æ–¹æ³•](#å¤‰æ›´æ–¹æ³•)
            - [ã‚»ãƒãƒ•ã‚©(semaphore)ã¨ã¯ï¼Ÿ](#ã‚»ãƒãƒ•ã‚©semaphoreã¨ã¯)
            - [SEMSML](#semsml)
            - [SEMMNS](#semmns)
            - [SEMOPM](#semopm)
            - [SEMMNI](#semmni)
        - [file-max](#file-max)
            - [å¤‰æ›´æ–¹æ³•](#å¤‰æ›´æ–¹æ³•-1)
        - [rem_default/rem_max/wmem_default/wmem_max](#rem_defaultrem_maxwmem_defaultwmem_max)
            - [å¤‰æ›´æ–¹æ³•](#å¤‰æ›´æ–¹æ³•-2)
        - [aio-max-nr](#aio-max-nr)
            - [å¤‰æ›´æ–¹æ³•](#å¤‰æ›´æ–¹æ³•-3)
    - [å‚è€ƒ](#å‚è€ƒ)

<!-- markdown-toc end -->

## Motivation
Documentã‚’æ¯å›èª­ã‚€ã®ãŒã‚ã‚“ã©ãã•ã„ãƒ»ä»–ã®äººãŒOracleæ²¼ã«ãƒãƒã‚‹ä¸€åŠ©ã«ãªã‚‹ãŸã‚ã«

## ãã‚‚ãã‚‚sysctlã¨ã¯ä½•ãªã®ã‹ï¼Ÿ
1. ã‚«ãƒ¼ãƒãƒ«ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä¸­ã«è¨­å®šã‚’åæ˜ ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
1. `/proc/sys/`ã‚’ä½¿ã†ã“ã¨ã§ç‰¹æ®Šãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã‚ãªãã¦ã‚‚åæ˜ ã§ãã‚‹

## Oracleã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­ã«é­é‡ã—ãŸkernel parameters
### semopm
ã‚»ãƒãƒ•ã‚©ã®é …ç›®ã®ä¸€ã¤
`/proc/sys/kernel/sem`ã«ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹
```sh
cat /proc/sys/kernel/sem
> 250	32000	32	128
```
å·¦ã‹ã‚‰SEMMSLã€SEMMNSã€SEMOPMã€SEMMNIã‚’è¡¨ã™
Oracleã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã¯3ã¤ç›®ã®é …ç›®ã‚’100ä»¥ä¸Šã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

#### å¤‰æ›´æ–¹æ³•
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
```sh
echo "kernel.semx=250 32000 200 1284" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

#### ã‚»ãƒãƒ•ã‚©(semaphore)ã¨ã¯ï¼Ÿ

ä¸€åº¦ã«ä¸€ã¤ã—ã‹å®Ÿè¡Œã§ããªã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä¿è­·ã™ã‚‹ä»•çµ„ã¿ã€‚ç·šè·¯ã«ã‚ã‚‹ä¿¡å·ã®ã‚ˆã†ãªæ¦‚å¿µã€‚
Mutexã¨åŒã˜ããƒ­ãƒƒã‚¯ã®æ¦‚å¿µã®ä¸€ã¤
ã‚»ãƒãƒ•ã‚©ã‚‚OSã®å‹‰å¼·ã‚’ã—ãŸã¨ãã«ã•ã‚‰ã£ãŸæ°—ãŒã™ã‚‹ã‘ã©åå‰ã‚’èã„ã¦æ€ã„å‡ºã›ãªã„ãã‚‰ã„ã«ã¯å¿˜ã‚ŒãŸã€‚

> ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿å†…ã®ã‚»ãƒãƒ•ã‚©ã¯ã€å˜ä¸€ã®æ•´æ•°ã§è¡¨ç¾ã•ã‚Œã¾ã™ã€‚ã‚¹ãƒ¬ãƒƒãƒ‰ã¯é€²è¡ŒãŒè¨±å¯ã•ã‚Œã‚‹ã®ã‚’å¾…ã¡ã€ãã®å¾Œé€²è¡Œã—ãŸã“ã¨ã‚’çŸ¥ã‚‰ã›ã‚‹ãŸã‚ã«ã‚»ãƒãƒ•ã‚©ã«å¯¾ã—ã¦ P æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

- Pæ“ä½œã¨Væ“ä½œ
   - ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ã‚»ãƒãƒ•ã‚©ãŒæ­£ã®å€¤ã‚’å–ã‚‹ã¾ã§å¾…ã¤å¿…è¦ãŒã‚ã‚Šã€é€²è¡Œã‚’é–‹å§‹ã™ã‚‹ã¨ã‚»ãƒãƒ•ã‚©ã‹ã‚‰1ã‚’å¼•ãã€ã‚»ãƒãƒ•ã‚©ã‚’å¤‰æ›´ã™ã‚‹ã€‚
     - ã“ã®æ“ä½œã‚’Pæ“ä½œã¨ã„ã†
   - å‡¦ç†ãŒå®Œäº†ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚»ãƒãƒ•ã‚©ã«1ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€ä»–ã®å‡¦ç†ãŒä¾µå…¥å¯èƒ½ãªçŠ¶æ…‹ã«æˆ»ã™ã€‚
     - ã“ã®å‡¦ç†ã‚’Vå‡¦ç†ã¨ã„ã†
   - ã“ã®2ã¤ã®å‡¦ç†ã«ã‚ˆã£ã¦ã‚»ãƒãƒ•ã‚©ã¯å¸¸ã«0ä»¥ä¸Šã€Vå‡¦ç†ã‚’ã•ã‚ŒãŸã‚ã¨ã®å€¤ãŒå‡¦ç†å‰ã‚ˆã‚Š1ã ã‘å°ã•ã„ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ã€‚

#### SEMSML

ã‚»ãƒãƒ•ã‚©é›†åˆã®æœ€å¤§ã‚»ãƒãƒ•ã‚©æ•°ã€‚ä¸€åº¦ã«ã„ãã¤ã®å‡¦ç†ãŒå®Ÿè¡Œå¯èƒ½åŒ–ã‚’è¡¨ã™ã€‚
På‡¦ç†ã§æ¸›ç®—ã•ã‚Œã‚‹ã¾ãˆã®æ•°å­—

#### SEMMNS

ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§å…¨ã¦ã®ã‚»ãƒãƒ•ã‚©ã®æ•°ã®åˆ¶é™

#### SEMOPM

SEMOPã‚³ãƒ¼ãƒ«ã«ã‚ˆã£ã¦æŒ‡å®šã•ã‚Œã‚‹ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€å¤§æ•°ã€‚
SEMOPã‚³ãƒ¼ãƒ«ã¯SEMSMLã®ç¯„å›²å†…ã§SEMOPMã¾ã§ã‚»ãƒãƒ•ã‚©æ•°ã‚’åŠ ç®—ã™ã‚‹ã€‚

#### SEMMNI

ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ã®ã‚»ãƒãƒ•ã‚©è­˜åˆ¥å­ã®æœ€å¤§å€¤

### file-max
`/proc/sys/fs/file-nr`ã«ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã€ã¾ãŸã¯`/proc/sys/fs/file-max`ã§è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹
```sh
cat /proc/sys/fs/file-nr
> 1248	0	379788
```
å·¦ã‹ã‚‰ç¾åœ¨é–‹ã‹ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®æ•°ã€ç©ºããƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†ãƒ‡ãƒ¼ã‚¿æ•°ã€ã‚·ã‚¹ãƒ†ãƒ ä¸­ã®æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ‡ãƒ¼ã‚¿æ•°
ç©ºããƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†ãƒ‡ãƒ¼ã‚¿æ•°ã¯ãƒ¡ãƒ¢ãƒªãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹ãŒã€ç¾åœ¨ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ã™ã€‚

#### å¤‰æ›´æ–¹æ³•
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
```sh
echo "fs.file-max=6815744\n" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

### rem_default/rem_max/wmem_default/wmem_max
`/proc/sys/net/core`ä»¥ä¸‹ã®ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€‚
ãã‚Œãã‚Œã‚½ã‚±ãƒƒãƒˆãƒãƒƒãƒ•ã‚¡ã«é€ä¿¡ã•ã‚ŒãŸã€ã¾ãŸã¯å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ãŠããƒãƒƒãƒ•ã‚¡ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€æœ€å¤§å€¤ã‚’è¡¨ã™ã€‚

#### å¤‰æ›´æ–¹æ³•
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
```sh
echo "net.core.rmem_default=262144" | sudo tee -a /etc/sysctl.conf
echo "net.core.rmem_max=41943044" | sudo tee -a /etc/sysctl.conf
echo "net.core.wmem_default=262144" | sudo tee -a /etc/sysctl.conf
echo "net.core.wmem_max=1048576" | sudo tee -a /etc/sysctl.conf

sudo sysctl -p
```

### aio-max-nr
`/proc/sys/fs/aio-nr`ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€‚
aio(active io_setup)ã®æœ€å¤§æ•°
#### å¤‰æ›´æ–¹æ³•
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
```sh
echo "fs.aio-max-nr=1048576" | sudo tee -a /etc/sysctl.conf

sudo sysctl -p
```


## å‚è€ƒ
https://github.com/torvalds/linux/tree/v4.15/Documentation/sysctl
https://thinkit.co.jp/cert/tech/23/5/2.htm
https://docs.oracle.com/cd/E19455-01/806-2732/6jbu8v6os/index.html
https://linuxjm.osdn.jp/html/LDP_man-pages/man2/semop.2.html
https://docs.oracle.com/cd/E19455-01/806-4505/svipc-9/index.html
https://www.atmarkit.co.jp/flinux/special/proctune/proctune02b.html
